# AI処理通知トースト

## 基本情報

| 項目             | 内容                                       |
| ---------------- | ------------------------------------------ |
| コンポーネントID | CMN-001                                    |
| コンポーネント名 | AI処理通知トースト                         |
| 種別             | グローバルコンポーネント（フローティング） |

## 概要

AI整形処理（要約生成）の進行状況をユーザーに通知するフローティングトースト。録音完了後にホーム画面へ遷移した際に表示され、**どの画面に遷移しても画面上部に表示され続ける**。処理完了後はタップして作成されたメモへ遷移可能。

## 画面イメージ

### 処理中

![AI整形を実行中](../assets/CMN-001_トーストAI整形を実行中.png)

### 処理完了

![AI整形が完了](../assets/CMN-001_トーストAI整形が完了.png)

### 処理失敗

![AI整形に失敗](../assets/CMN-001_トーストAI整形に失敗.png)

## 要素一覧

### 処理中状態

| 要素ID               | 要素名         | 種別     | 説明                               |
| -------------------- | -------------- | -------- | ---------------------------------- |
| toast_processing     | 処理中トースト | トースト | フローティングトーストコンテナ     |
| processing_text      | 処理中テキスト | ラベル   | 「AI整形を実行中」                 |
| processing_sub_text  | サブテキスト   | ラベル   | 「バックグラウンドで処理中」       |
| processing_indicator | プログレス表示 | アイコン | ローディングインジケーター（青丸） |

### 完了状態

| 要素ID           | 要素名       | 種別     | 説明                           |
| ---------------- | ------------ | -------- | ------------------------------ |
| toast_completed  | 完了トースト | トースト | フローティングトーストコンテナ |
| completed_text   | 完了テキスト | ラベル   | 「AI整形が完了」               |
| completed_action | 確認リンク   | リンク   | 「タップして確認する」         |
| completed_icon   | 完了アイコン | アイコン | チェックマークアイコン（緑丸） |

### 失敗状態

| 要素ID        | 要素名       | 種別     | 説明                              |
| ------------- | ------------ | -------- | --------------------------------- |
| toast_failed  | 失敗トースト | トースト | フローティングトーストコンテナ    |
| failed_text   | 失敗テキスト | ラベル   | 「AI整形に失敗」                  |
| failed_action | リトライ案内 | ラベル   | 「長押しで破棄 / タップで再試行」 |
| failed_icon   | 失敗アイコン | アイコン | ×アイコン（赤丸）                 |

## 表示条件

| 条件               | 動作                                           |
| ------------------ | ---------------------------------------------- |
| AI整形処理開始     | 処理中トーストを表示                           |
| AI整形処理完了     | 完了トーストに切り替え                         |
| AI整形処理失敗     | 失敗トーストに切り替え                         |
| 完了トーストタップ | 作成されたメモ詳細画面へ遷移、トーストを非表示 |
| 失敗トーストタップ | AI整形処理を再試行                             |
| 失敗トースト長押し | 処理を破棄、トーストを非表示                   |
| トーストスワイプ   | トーストを非表示（任意で閉じる）               |
| 画面遷移           | **遷移先でもトーストを継続表示**               |

## 表示トリガー

| トリガー                             | 説明                                     |
| ------------------------------------ | ---------------------------------------- |
| 録音画面で「完了してAI整形する」押下 | 処理中トーストを表示し、ホーム画面へ遷移 |

## API連携

| メソッド | エンドポイント        | 用途                               |
| -------- | --------------------- | ---------------------------------- |
| GET      | /api/memos/:id/status | メモのAI処理状態をポーリングで確認 |

### ステータス値

| status       | 説明         | トースト表示   |
| ------------ | ------------ | -------------- |
| `processing` | AI整形処理中 | 処理中トースト |
| `completed`  | AI整形完了   | 完了トースト   |
| `failed`     | AI整形失敗   | 失敗トースト   |

## 備考

- 処理はバックグラウンドで実行されるため、アプリ操作を妨げない
- 複数の処理が同時に走る場合の仕様は将来検討
- ネットワークエラー時はリトライ案内を表示予定
